<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>智能段码生成器｜LED Config Pro</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .container {
            background: var(--surface);
            border-radius: 1rem;
            box-shadow: 0 12px 24px -6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .config-panel {
            padding: 2rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        input[type="text"] {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        select {
            appearance: none;
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            background: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231e293b'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e")
                        no-repeat right 1rem center/1.5rem;
        }

        button {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px -2px rgba(99, 102, 241, 0.4);
        }

        .result-section {
            background: #f1f5f9;
            padding: 2rem;
            border-radius: 0 0 1rem 1rem;
        }

        .code-card {
            background: var(--surface);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        .code-card h3 {
            margin: 0 0 1rem;
            font-size: 1.125rem;
            color: var(--primary);
        }

        .code-block {
            font-family: 'SF Mono', Menlo, monospace;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }

        .error {
            color: #dc2626;
            background: #fee2e2;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            display: none;
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }

            .container {
                border-radius: 0.75rem;
            }

            .header {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LED Config Pro</h1>
            <p>智能数码管段码生成解决方案</p>
        </div>

        <div class="config-panel">
            <div class="input-group">
                <label for="segment_map">段码映射</label>
                <input type="text"
                       id="segment_map"
                       placeholder="示例: a1b2c3d4e5f6g7dp0"
                       value="e4d5dp2c6g7a1f0b3">
            </div>

            <div class="input-group">
                <label for="active_level">有效电平</label>
                <select id="active_level">
                    <option value="1">高电平有效 (共阴数码管)</option>
                    <option value="0">低电平有效 (共阳数码管)</option>
                </select>
            </div>

            <button onclick="generateCode()">生成段码配置</button>
            <div id="error" class="error"></div>
        </div>

        <div class="result-section" id="result" style="display: none;">
            <div class="code-card">
                <h3>常规数字段码</h3>
                <div class="code-block" id="num_codes"></div>
            </div>

            <div class="code-card">
                <h3>带小数点段码</h3>
                <div class="code-block" id="num_dp_codes"></div>
            </div>

            <div class="code-card">
                <h3>字母符号段码</h3>
                <div class="code-block" id="letter_codes"></div>
            </div>
        </div>
    </div>

    <script>
        // 完整的段码表定义
        const segmentTable = {
            // 数字部分
            0: [1,1,1,1,1,1,0,0], 1: [0,1,1,0,0,0,0,0],
            2: [1,1,0,1,1,0,1,0], 3: [1,1,1,1,0,0,1,0],
            4: [0,1,1,0,0,1,1,0], 5: [1,0,1,1,0,1,1,0],
            6: [1,0,1,1,1,1,1,0], 7: [1,1,1,0,0,0,0,0],
            8: [1,1,1,1,1,1,1,0], 9: [1,1,1,1,0,1,1,0],

            // 字母和符号
            'A': [1,1,1,0,1,1,1,0], 'B': [0,0,1,1,1,1,1,0],
            'C': [1,0,0,1,1,1,0,0], 'D': [0,1,1,1,1,1,1,0],
            'E': [1,0,0,1,1,1,1,0], 'F': [1,0,0,0,1,1,1,0],
            'H': [0,1,1,0,1,1,1,0], 'L': [0,0,0,1,1,1,0,0],
            'P': [1,1,0,0,1,1,1,0], 'U': [0,1,1,1,1,1,0,0],
            '-': [0,0,0,0,0,0,1,0], 'r': [0,0,0,0,1,0,1,0],
            'o': [0,0,1,1,1,0,1,0], 'i': [0,0,1,0,0,0,0,0],
            't': [0,0,0,1,1,1,1,0]
        };

        function generateCode() {
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'none';
            resultDiv.style.display = 'none';

            try {
                const segmentMap = document.getElementById('segment_map').value;
                const activeLevel = parseInt(document.getElementById('active_level').value);

                // 生成段码配置
                const { maskDict, dpBit } = generateSegmentMask(segmentMap, activeLevel);

                // 显示结果
                displayResults(maskDict, dpBit);
                resultDiv.style.display = 'block';
            } catch (error) {
                errorDiv.textContent = error;
                errorDiv.style.display = 'block';
            }
        }

        // 核心生成函数
        function generateSegmentMask(segmentMap, activeLevel) {
            const { segmentToBit, dpBit } = parseSegmentMap(segmentMap);
            const maskDict = {};

            // 为每个字符生成掩码
            Object.keys(segmentTable).forEach(char => {
                let mask = 0;
                Object.entries(segmentToBit).forEach(([segment, bit]) => {
                    const segIndex = segment === 'dp' ? 7 : segment.charCodeAt(0) - 97;
                    let state = segmentTable[char][segIndex];

                    if (activeLevel === 0) state = 1 - state;
                    if (state) mask |= (1 << bit);
                });
                maskDict[char] = mask;
            });

            return { maskDict, dpBit };
        }

        // 解析段码映射
        function parseSegmentMap(segmentMap) {
            const segmentToBit = {};
            let dpBit = null;
            let i = 0;

            while (i < segmentMap.length) {
                const c = segmentMap[i];
                if (!/[a-zA-Z]/.test(c)) throw `无效字符: 位置 ${i} 应为字母`;

                let segment;
                if (c.toLowerCase() === 'd' && segmentMap[i+1]?.toLowerCase() === 'p') {
                    segment = 'dp';
                    i += 2;
                } else {
                    segment = c.toLowerCase();
                    i += 1;
                }

                if (i >= segmentMap.length || !/\d/.test(segmentMap[i])) {
                    throw `格式错误: ${segment} 后缺少位编号`;
                }

                const bit = parseInt(segmentMap[i]);
                segmentToBit[segment] = bit;
                if (segment === 'dp') dpBit = bit;
                i++;
            }

            if (!dpBit) throw "必须定义小数点(dp)位";
            return { segmentToBit, dpBit };
        }

        // 显示结果
        function displayResults(maskDict, dpBit) {
        // 生成数字部分
        const numbers = Array.from({length: 10}, (_, i) => i);
        const numLabels = numbers.map(n => `${n}`.padStart(4, ' ')).join(', ');
        const numCodes = numbers.map(n => `0x${maskDict[n].toString(16).toUpperCase().padStart(2, '0')}`).join(', ');

        // 生成带DP位的数字部分
        const numDpCodes = numbers.map(n => `0x${(maskDict[n] | (1 << dpBit)).toString(16).toUpperCase().padStart(2, '0')}`).join(', ');

        // 生成字母部分
        const letters = Object.keys(maskDict)
            .filter(k => typeof k === 'string' && k.length === 1 && /[A-Za-z]/.test(k))
            .sort();
        const letterLabels = letters.map(c => `${c}`.padStart(4, ' ')).join(', ');
        const letterCodes = letters.map(c => `0x${maskDict[c].toString(16).toUpperCase().padStart(2, '0')}`).join(', ');

        // 构建输出内容
        const buildOutput = (labels, codes) => {
            return `依次对应的是：[${labels}]\n对应段码数组：[${codes}]`;
        };

        // 更新显示
        document.getElementById('num_codes').innerHTML =
            `<pre>${buildOutput(numLabels, numCodes)}</pre>`;

        document.getElementById('num_dp_codes').innerHTML =
            `<pre>${buildOutput(numLabels, numDpCodes)}</pre>`;

        document.getElementById('letter_codes').innerHTML =
            `<pre>${buildOutput(letterLabels, letterCodes)}</pre>`;
    }

        // 格式化16进制输出
        function formatHex(value) {
            return '0x' + value.toString(16).toUpperCase().padStart(2, '0');
        }
        </script>
</body>
<!-- 在<body>标签内的最底部添加 -->
<div class="author-info">
    <span>Developed with ❤️ by </span>
    <a href="https://github.com/8578571145" target="_blank" rel="noopener">
        XiBeiLaoHan-
    </a>
</div>

<style>
/* 添加样式 */
.author-info {
    text-align: center;
    margin: 2rem 0;
    color: #64748b;
    font-size: 0.875rem;
}

.author-info a {
    color: #6366f1;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s;
}

.author-info a:hover {
    color: #4f46e5;
    text-decoration: underline;
}
</style>
</html>
